# 插头DP

## 回路问题

插头成对出现，轮廓线上不同连通块的数量不超过$m$（列数）的一半。

轮廓线记录$(m+1)$位，逐格转移，可能的转移有：

- 封口：合并两个不一定属于同一连通块的插头（单条回路时只能在最后一个可行格子时合并本来就属于同一个连通块的两个插头，多条回路则无限制）
- 新增：添加两个属于同一个新连通块的插头
- 向右或向下延伸：交换两个插头
- 向右或向下拐弯：保持状态不变

换行时判断最右的插头必须为空然后状态整体右移。

## 简单路径

一条简单路径的情况，追加记录有多少个度数为$1$的格子，大于$2$非法。

- 封口：一定不能合并属于同一连通块的插头
- 新增：添加一个或两个属于同一个新连通块的插头，增加一个的时候增加度数为$1$的格子数量
- 向右或向下延伸：交换两个插头
- 向右或向下拐弯：保持状态不变
- 结束插头：当只有左边或上边有插头时，清除插头，并增加度数为$1$的格子数量

换行时一样判断最右的插头必须为空然后状态整体右移。

最后答案取轮廓线上没有插头，且度数为$1$的格子数量恰好为$2$的状态。

单个点的简单路径不在`dp`中，直接预处理。

# 斜率优化

最大化$x+ky$，$k>0$时维护上凸壳，$k<0$时维护下凸壳，最小化时相反。