
# 抽象代数

## 有限群中元素的幂

设 $G$ 为一有限群。令 $|G|=n$，对于 $G$ 的每个元素 $a$ 有 $a^{n}=e$ 。



# 数学分析

## Wallis公式

$$
\frac{\pi}{2} = \lim_{n \to +\infty}\frac{[\frac{(2n)!!}{(2n-1)!!}]^{2}}{2n+1}
$$

## Stirling公式

$$
n!\sim\sqrt{2\pi n}(\frac{n}{e})^{n}
$$

## n维球

$n$维球的体积公式：$\displaystyle{\frac{\pi^{\frac{n}{2}}}{\Gamma(\frac{n}{2}+1)}r^{n}}$

$n$维球的表面积公式：$\displaystyle{\frac{2\pi^{\frac{n}{2}}}{\Gamma(\frac{n}{2})}r^{n-1}=V_{n}'(r)}$

其中伽马函数 $\Gamma(z)=\int_{0}^{\infty}x^{z-1}e^{-x}\mathbb{d}x$ ，满足

 - $\Gamma(1)=1,\Gamma(z+1)=z\Gamma(z)(z>0)$
 - $\Gamma(1-z)\Gamma(z)=\frac{\pi}{\sin(\pi z)}(z\notin\mathbb{Z})$
 - $\Gamma(z)\Gamma(z+\frac{1}{2})=2^{1-2z}\sqrt{\pi}\Gamma(2z)$
 - $\Gamma(\frac{1}{2})=\sqrt{\pi}$


# 组合数学

## 划分数

设 $p(n)$ 为将 $n$ 写成若干个正整数和的方案数，若 $i$ 为自然数，称 $\frac{3i^{2}-i}{2}$ 和 $\frac{3i^{2}+i}{2}$ 为广义五边形数，并定义 $f(\frac{3i^{2}-i}{2}) = f(\frac{3i^{2}+i}{2}) = i$ ，则 $p(n) = \sum_{u,1 \le u \le n}(-1)^{f(u) - 1}p(n-u)$ ，其中 $u$ 为广义五边形数。$\displaystyle{\phi(x)=\prod_{i=1}^{\infty}(1-x^{i})}$ 称为欧拉函数，它是划分数生成函数的逆。 $\phi(x) = \sum_{u}(-1)^{f(u)}x^{u}$ ，其中 $u$ 为广义五边形数。从 $0$ 开始， $p(n)$ 的前若干项为 $1,1,2,3,5,7,11,15,22,30,42,56,77$ 。

## 模2意义下的组合数

${n\choose m}\% 2=!(m\And(\sim n))$ 。由此易知， ${n\choose m}\% 2=1$ ，当且仅当  $n$ 在 $m$ 为 $1$ 的二进制位上也都为 $1$ 。易知， ${n+m\choose m}\% 2=1$ ，当且仅当  $n$ 在 $m$ 为 $1$ 的二进制位上都为 $0$ 。

## 默慈金数

设 $M_{n}$ 表示在一个圆上的 $n$ 个不同点间，画出彼此不相交的弦的全部方法的总数。 $M_{0} = M_{1} = 1, M_{n + 1} = M_{n}+\sum_{i=0}^{n-1}M_{i}M_{n-i-1} = \frac{2n+3}{n+3}M_{n}+\frac{3n}{n+3}M_{n-1}$ 。它也可以表示数列 $\{a_{i}\}(0 \le i \le n)$ 的数量，满足： $a_{0} = a_{n} = 0, a_{i} \ge 0, |a_{i}-a_{i + 1}| \le 1$ 。从 $0$ 开始， $M_{n}$ 的前若干项为
$$
\begin{aligned}
&1,1,2,4,9,21,51,127,323,835,2188,\\
&5798,15511,41835,113634,310572,853467,\\
&2356779,6536382,18199284,50852019,142547559,\\
&400763223,1129760415,3192727797,9043402501,\\
&25669818476,73007772802,208023278209,593742784829
\end{aligned}
$$

## 卡特兰数

设 $C_{0}=1,C_{n}=\sum_{i=0}^{n-1}C_{i}C_{n-i-1}$ ，它满足 $\displaystyle{C_{n} = \frac{C_{2n}^{n}}{n+1}}$ ，它可以表示：

- $n$ 对括号组成的合法的表达式种数
- $n$ 个结点不同构二叉树的方案数
- $n \times n$ 格点中不越过对角线的单调路径的个数。单调路径是指从左下角走到右上角，每步向右或向上。
- 通过连接顶点将 $n+2$ 条边的凸多边形分成三角形的方案数
- 以 $\{1, 2, \cdots, n\}$ 为进栈序列的合法出栈序列个数
- 集合 $\{1, 2, \cdots, n\}$ 的不交叉划分的个数
- 用 $n$ 个长方形填充一个高度为 $n$ 的阶梯状图形的方法个数

从 $0$ 开始， $C_{n}$ 的前若干项为
$$
\begin{aligned}
&1,1,2,5,14,42,132,429,1430,\\
&4862,16796,58786,208012,742900,\\
&2674440,9694845,35357670,129644790,\\
&477638700,1767263190
\end{aligned}
$$

## 伯努利数

$B_{0} = 1, B_{i}=1-\sum_{j = 0}^{i-1}C_{i}^{j}\frac{B_{j}}{i-j+1}.$ 伯努利数的指数型母函数是 $\frac{x}{e^{x}-1}.$ 伯努利数可用于计算等幂和：$\sum_{k = 1}^{n}k^{m} = \frac{1}{m+1}\sum_{k=0}^{m}C_{m+1}^{k}B_{k}n^{m+1-k}.$ 从 $0$ 开始，$B_{n}$ 的前若干项为 $1,\frac{1}{2},\frac{1}{6},0,-\frac{1}{30},0,\frac{1}{42},0,-\frac{1}{30}$

## 上升阶乘幂和下降阶乘幂
$(x)^{(n)}=x(x+1)(x+2)\cdots(x+n-1)$ 称为上升阶乘幂， $(x)_{n}=x(x-1)(x-2)\cdots(x-n+1)$ 称为下降阶乘幂。 满足：

- $(a+b)^{(n)}=\sum_{i=0}^{n}{n\choose i}(a)^{(n-j)}(b)^{(j)}$
- $(a+b)_{n}=\sum_{i=0}^{n}{n\choose i}(a)_{n-j}(b)_{j}$
- $(x)_{m}(x)_{n}=\sum_{k=0}^{m}{m\choose k}{n\choose k}k!(x)_{m+n-k}$

## 斯特林数

### 第一类斯特林数

$\begin{bmatrix}n\\k\end{bmatrix}$ 表示 $n$ 个元素的置换中能被分解为 $k$ 个循环的置换个数，并定义 $s(n,k)=(-1)^{n-k}\begin{bmatrix}n\\k\end{bmatrix}$。 $\begin{bmatrix}n+1\\k\end{bmatrix}=n\begin{bmatrix}n\\k\end{bmatrix}+\begin{bmatrix}n\\k-1\end{bmatrix}(k>0)$，$\begin{bmatrix}0\\0\end{bmatrix}=1$，$\begin{bmatrix}n\\0\end{bmatrix}=\begin{bmatrix}0\\n\end{bmatrix}=0(n>0)$。
该数列满足：

- $(x)^{(n)}=\sum_{k=0}^{n}\begin{bmatrix}n\\k\end{bmatrix}x^{k}$
- $(x)_{n}=\sum_{k=0}^{n}s(n,k)x^{k}$

也就是说，对于一个固定的 $n$，$(x)^{(n)}$ 和 $(x)_{n}$ 分别是 $\{\begin{bmatrix}n\\k\end{bmatrix}\}$ 和 $\{s(n,k)\}$ 的生成函数。

对于一个固定的 $k$，$\{\begin{bmatrix}n\\k\end{bmatrix}\}$ 的指数型生成函数为：$\displaystyle{\frac{\ln^{k}\frac{1}{1-x}}{k!}=\sum_{n=k}^{+\infty}\begin{bmatrix}n\\k\end{bmatrix}\frac{x^{n}}{n!}}$。

另外还有：

- $\begin{bmatrix}n\\m\end{bmatrix}=\sum_{k}\begin{bmatrix}n+1\\k+1\end{bmatrix}{k\choose m}(-1)^{m-k}$
- $\begin{bmatrix}n+1\\m+1\end{bmatrix}=\sum_{k=0}^{n}\begin{bmatrix}k\\m\end{bmatrix}\frac{n!}{k!}$
- $\begin{bmatrix}m+n+1\\m\end{bmatrix}=\sum_{k=0}^{m}(n+k)\begin{bmatrix}n+k\\k\end{bmatrix}$
- $\begin{bmatrix}n\\l+m\end{bmatrix}{l+m\choose l}=\sum_{k}\begin{bmatrix}k\\l\end{bmatrix}\begin{bmatrix}n-k\\m\end{bmatrix}{n\choose k}$

### 第二类斯特林数

$\begin{Bmatrix}n\\k\end{Bmatrix}$ 表示有 $n$ 个元素的集合划分为 $k$ 个集合的方案数。$\begin{Bmatrix}n+1\\k\end{Bmatrix}=k\begin{Bmatrix}n\\k\end{Bmatrix}+\begin{Bmatrix}n\\k-1\end{Bmatrix}(k>0)$，$\begin{Bmatrix}0\\0\end{Bmatrix}=1$，$\begin{Bmatrix}n\\0\end{Bmatrix}=\begin{Bmatrix}0\\n\end{Bmatrix}=0(n>0)$。

该数列满足：

- $\begin{Bmatrix}n\\k\end{Bmatrix}=\frac{1}{k!}\sum_{i=0}^{k}(-1)^{i}{k\choose i}(k-i)^{n}$

容易注意到这是一个卷积形式，可以 $\mathcal{O}(n\log n)$ 地求出一个 $n$ 对应的所有第二类斯特林数

- $\sum_{k=0}^{n}\begin{Bmatrix}n\\k\end{Bmatrix}(x)_{k}=x^{n}$
- $B_{n}=\sum_{k=0}^{n}\begin{Bmatrix}n\\k\end{Bmatrix}$（其中 $B_{n}$ 是贝尔数）

对于一个固定的 $k$，$\{\begin{Bmatrix}n\\k\end{Bmatrix}\}$ 的生成函数为 $\displaystyle{\sum_{n=k}^{+\infty}\begin{Bmatrix}n\\k\end{Bmatrix}x^{n}=\frac{x^{k}}{\prod_{i=1}^{k}1-kx}}$，其指数型生成函数为 $\displaystyle{\sum_{n=k}^{+\infty}\begin{Bmatrix}n\\k\end{Bmatrix}\frac{x^{n}}{n!}=\frac{(e^{x}-1)^{k}}{k!}}$。

## 贝尔数

设 $B_{n}$ 表示基数为 $n$ 的集合的划分方法数，则 $B_{n}$ 满足 $B_{n+1}=\sum_{k=0}^{n}{n\choose k}B_{k}$ ， $B_{n}=\sum_{k=0}^{n}S(n, k)$ ，其中 $S$ 是第二类斯特林数，对任意质数 $p$ 有 $B_{n+p}\equiv B_{n}+B_{n+1}\pmod{p}$ ，其指数型母函数是 $\sum_{n=0}^{\infty}\frac{B_{n}}{n!}x^{n}=e^{e^{x}-1}$ 。从 $0$ 开始， $B_{n}$ 的前若干项为 
$$
\begin{aligned}
&1,1,2,5,15,52,203,877,\\
&4140,21147,115975,678570,\\
&4213597,27644437,190899322,\\
&1382958545,10480142147,82864869804,\\
&682076806159,5832742205057,51724158235372,\\
&474869816156751,4506715738447323,44152005855084346,\\
&445958869294805289,4638590332229999353,49631246523618756274
\end{aligned}
$$

## Burnside 引理

设 $G$ 是一个有限群，作用于集合 $X$ 上，对 $\forall g\in G$，$X^{g}$ 表示 $X$ 中在 $g$ 作用下的不动元素的集合，$|X/G|$ 表示 $X$ 在 $G$ 作用下的轨道数，则有 $|X/G|=\frac{1}{|G|}\sum_{g\in G}|X^{g}|$。

## Polya 定理

设 $\bar{G}$ 是 $n$ 个对象的一个置换群，用 $m$ 种颜色涂染这 $n$ 个对象，则不同染色的方案数为 $l=\frac{1}{|\bar{G}|}(m^{c(\bar{a_{1}})}+m^{c(\bar{a_{2}})}+\cdots+m^{c(\bar{a_{g}})})$ ，其中 $c(\bar{a_{i}})$ 表示置换 $\bar{a_{i}}$ 的循环节数。

## 切比雪夫多项式

第一类切比雪夫多项式为 $T_{n}(\cos x)=\cos nx$ ，满足 $\displaystyle{[x^{m}]T_{n}=(-1)^{\frac{n-m}{2}}\frac{n}{m}{\frac{n+m}{2}-1\choose m-1}2^{m-1}}$ 。第二类切比雪夫多项式为 $U_{n}(\cos x)=\frac{\sin(n+1)x}{\sin x}$ ，满足 $\displaystyle{[x^{m}]U_{n}=(-1)^{\frac{n-m}{2}}{\frac{n+m}{2}\choose \frac{n-m}{2}}2^{m}}$ 。

## 杨式矩阵和钩子公式

杨式矩阵是指满足以下两个条件的矩阵：

- 如果格子 $(i,j)$ 没有元素，则它右边和上边的相邻格子也一定没有元素。
- 如果格子 $(i,j)$ 有元素 $a_{i,j}$ ，则它右边和上边的相邻格子要么没有元素，要么有元素且比 $a_{i,j}$ 大。

$1\sim n$所组成杨氏矩阵的个数可以通过下面的递推式得到：

$F_{1}=1,F_{2}=2,F_{n}=F(n-1)+(n-1)F(n-2)$

钩子公式是指：对于给定形状，不同的杨氏矩阵的个数为：$n!$  除以每个格子的钩子长度加 $1$ 的积。其中钩子长度定义为该格子右边的格子数和它上边的格子数之和。

## 全错排

$1\sim n$ 的全错排数量为 $n!\sum_{i=0}^{n}(-1)^{i}\frac{1}{i!}$

## 可拆分排列

排列的直和是指将两个排列拼起来，将右边的排列平移；排列的斜和是指将两个排列拼起来，将左边的排列平移。例如 $1,2$ 和 $1,2,3$ 的直和为 $1,2,3,4,5$，斜和为 $4,5,1,2,3$。定义可拆分排列为可以由 $1$ 这一种排列经过若干次斜和和直和的运算得到的排列。

## 大 $Schr\ddot{o}der$ 数

设 $S_{n}$ 表示从 $(0,0)$ 走到 $(n,n)$，每次只能向右、向上、向右上走一步，且不能跨过 $(0,0)$ 到 $(n,n)$ 的对角线的不同走法数量。那么有 $S_{0}=1,S_{1}=2,S_{n}=3S_{n-1}+\sum_{k=1}^{n-2}S_{k}S_{n-k-1}$。$S_{n}$ 的生成函数是 $\frac{1-x-\sqrt{x^{2}-6x+1}}{2x}$。$S_{n}=\sum_{i=0}^{n}\frac{1}{n-i+1}\frac{(2n-i)!}{i!((n-i)!)^{2}}$。

$S_{n}$ 还可以表示长度为 $n+1$ 的可拆分排列的数量。

从 $0$ 开始，$S_{n}$ 的前若干项为
$$
\begin{aligned}
&1,2,6,22,90,394,\\
&1806,8558,41586,206098,\\
&1037718,5293446,27297738,\\
&142078746,745387038,3937603038,\\
&20927156706,111818026018,600318853926,\\
&3236724317174,17518619320890,95149655201962,\\
&518431875418926,2832923350929742,15521467648875090
\end{aligned}
$$

## 小 $Schr\ddot{o}der$ 数

设 $s_{0}=1,s_{i+1}=\frac{S_{i}}{2}$，那么 $s_{n}=\frac{1}{n}((6n-9)s_{n-1}-(n-3)s_{n-2})$。$s_{n}$ 可以表示：

- 将 $n+1$ 边形剖分的方案数
- 给 $n$ 个数加括号的方案数

## 库默尔定理

设 $p$ 为质数，$a,b$ 在 $p$ 进制下的表示分别为 $\overline{\cdots a_{n}\cdots a_{0}}$ 和 $\overline{\cdots b_{n}\cdots b_{0}}$，那么 ${a\choose b}$ 中含有质因子 $p$ 的个数为满足 $\overline{\cdots a_{i}\cdots a_{0}}<\overline{\cdots b_{i}\cdots b_{0}}$ 的下标 $i$ 的个数。特别的，当 $a<b$ 时，${a\choose b}=0$，而满足条件的 $i$ 也有无穷多个。从另一种角度来说，也可以理解成 $a$ 和 $a-b$ 在做 $p$ 进制加法时产生进位的次数。这可以得到一个显然的推论：${a\choose b}$ 中 $p$ 的个数不超过 $\log_{p}a$。

## 不动函数的数量

设 $f:\{1,2,\cdots,n\}\to\{1,2,\cdots,n\}$，且 $\overbrace{f\circ\cdots\circ f}^{k个}(i)=f(i)$ 对 $\{1,2,\cdots,n\}$ 成立，那么满足条件的 $f$ 指数型生成函数为 $\exp(\sum_{i\mid k-1}(x\cdot \exp(x))^{i}/i)$

## 其它

$\sum{n\choose2k}{k\choose m}=\frac{n}{n-m}{n-m\choose n-2m}2^{n-2m-1}$


# 插头DP

## 回路问题

插头成对出现，轮廓线上不同连通块的数量不超过$m$（列数）的一半。

轮廓线记录$(m+1)$位，逐格转移，可能的转移有：

- 封口：合并两个不一定属于同一连通块的插头（单条回路时只能在最后一个可行格子时合并本来就属于同一个连通块的两个插头，多条回路则无限制）
- 新增：添加两个属于同一个新连通块的插头
- 向右或向下延伸：交换两个插头
- 向右或向下拐弯：保持状态不变

换行时判断最右的插头必须为空然后状态整体右移。

## 简单路径

一条简单路径的情况，追加记录有多少个度数为$1$的格子，大于$2$非法。

- 封口：一定不能合并属于同一连通块的插头
- 新增：添加一个或两个属于同一个新连通块的插头，增加一个的时候增加度数为$1$的格子数量
- 向右或向下延伸：交换两个插头
- 向右或向下拐弯：保持状态不变
- 结束插头：当只有左边或上边有插头时，清除插头，并增加度数为$1$的格子数量

换行时一样判断最右的插头必须为空然后状态整体右移。

最后答案取轮廓线上没有插头，且度数为$1$的格子数量恰好为$2$的状态。

单个点的简单路径不在`dp`中，直接预处理。

# 斜率优化

最大化$x+ky$，$k>0$时维护上凸壳，$k<0$时维护下凸壳，最小化时相反。

# 博弈论

## 威佐夫游戏

有两堆石子，两人轮流取，每次可以从一堆中取若干颗石子，也可以从两堆中取一样多的石子。负态为$\{\lfloor k\cdot\frac{1+\sqrt{5}}{2}\rfloor, k+\lfloor k\cdot\frac{1+\sqrt{5}}{2}\rfloor\}(k = 0,1,2,\cdots)$

## 翻硬币游戏

翻硬币游戏是指这样的一种组合游戏：有 $n$ 枚硬币排成一排，开始时它们有的正面朝上，有的反面朝上，两名玩家轮流按照一定的规则，翻转一些硬币，最后不能操作者输。这里的规则必须满足以下两点：

- 最右边的硬币必须是从正面翻转到反面（为了保证游戏结束）
- 规则允许的翻转位置集合唯一取决于最右侧硬币的位置，而与之前的操作、玩家等无关（为保证这是一个平等博弈）

翻硬币游戏有这样一个结论：一个局面的 $sg$ 值等于所有正面硬币的 $sg$ 值的异或，以 `H` 表示正，`T` 表示反，例如：$sg(THHTTH)=sg(TH)\oplus sg(TTH)\oplus sg(TTTTTH)$。

## Nim 积

$a\otimes b=\text{mex}\{a'\otimes b\oplus a\otimes b'\oplus a'\otimes b'|0\le a'<a,0\le b'<b\}$ 满足交换律，结合律，对 nim 和（异或）满足分配律。全体非负整数在 nim 和和 nim 积下成一域。Tartan Games（即二维硬币游戏）的 $sg$ 值是对应行列的 nim 积。

nim积还具有如下的性质：

- 对全体自然数 $n$ ， $[0,2^{2^{n}}-1]$ 中的自然数在 nim 和和 nim 积下成一域
- 对全体自然数 $n$ ， $2^{2^{n}}\otimes x=2^{2^{n}}\times x(0\le x<2^{2^{n}})$
- 对全体自然数 $n$ ， $2^{2^{n}}\otimes 2^{2^{n}}=\frac{3}{2}\cdot2^{2^{n}}=2^{2^{n}}\oplus2^{2^{n}-1}$

## surreal number

$surreal\;number$ 是一个包含无穷小、无穷大和实数的域，用它可以十分方便地研究一些不平等博弈问题。 $surreal\;number$ 定义为一个集合对 $\{L|R\}$ ，其中 $L$ 中的每个元素小于 $R$ 中的每个元素。我们称 $x\le y$ 当且仅当不存在 $x_{L}\in X_{L}$ 使得 $y\le x_{L}$ ，且不存在 $y_{R}\in Y_{R}$ 使得 $y_{R}\le x$ 。 $surreal\;number$ 有如下的一些性质：

- 对于一个 $surreal\;number$ $x=\{L|R\}$  ， $x$ 大于 $L$ 中的任意一个元素，小于 $R$ 中的任意一个元素。
- 对于一个 $surreal\;number$ $x=\{L|R\}$ ，若 $L$ 有最大值 $l_{max}$，则 $x=\{l_{max}|R\}$ ，对于 $R$ 同理。
- 设 $a$ 到 $b$ 之间最早出生的 $surreal\;number$ 在第 $i$ 天出生，那么在 $a$ 到 $b$ 之间且在第 $i$ 天出生的 $surreal\;number$ 有且只有一个。
- 若 $a<x<b$ 且 $x$ 是 $a$ 和 $b$ 之间最早出生的 $surreal\;number$ ，则 $x=\{a|b\}$ 

$surreal\;number$ 的加法法则为 $x+y=\{X_{L}|X_{R}\}+\{Y_{L}|Y_{R}\}=\{X_{L}+y,x+Y_{L}|X_{R}+y,x+Y_{R}\}$ 。

$surreal\;number$ 的取反法则为 $-x=-\{X_{L}|X_{R}\}=\{-X_{R}|-X_{L}\}$ 

$surreal\;number$ 的乘法法则为 $xy=\{X_{L}|X_{R}\}\{Y_{L}|Y_{R}\}=\{X_{L}y+xY_{L}-X_{L}Y_{L}，X_{R}y+xY_{R}-X_{R}Y_{R}|X_{L}y+xY_{R}-X_{L}Y_{R}，xY_{L}+X_{R}y-X_{R}Y_{L}\}$

$surreal\;number$ 的取逆法则为 $\displaystyle{\frac{1}{y}=\{0,\frac{1+(y^{R}-y)(\frac{1}{y})^{L}}{y^{R}},\frac{1+(y^{L}-y)(\frac{1}{y})^{R}}{y^{L}}|\frac{1+(y^{L}-y)(\frac{1}{y})^{L}}{y^{L}},\frac{1+(y^{R}-y)(\frac{1}{y})^{R}}{y^{R}}\}}$ ，其中 $y^{L}>0,y^{R}>0$

设有一组合游戏处于局面 $P$ ，玩家 $L$ 可以转移到的状态为 $P^{L}$ ，玩家 $R$ 可以转移到的状态为 $P^{R}$ ，我们记 $P=\{P^{L}|P^{R}\}$ 。那么：

- 若 $P>0$ ，则不论先手还是后手， $L$ 获胜
- 若 $P<0$ ，则不论先手还是后手， $R$ 获胜
- 若 $P=0$ ，则后手获胜

类似于 $Nim$ 和游戏，若有 $n$ 个不平等游戏 $P_{1},\cdots,P_{n}$ ，它们分别对应的 $surreal\;number$ 为 $x_{1},\cdots,x_{n}$ ，则 $P_{1}+\cdots+P_{n}$ 对应的 $surreal\;number$ 为 $x_{1}+\cdots+x_{n}$ 。

最后给出一些无穷大和无穷小的 $surreal\;number$

$$
\begin{aligned}\\
&\{0|1,\frac{1}{2},\frac{1}{4},\cdots\}=\epsilon(无穷小)\\
&\{0,1,2,3,\cdots|\}=\omega(无穷大)\\
&\{\epsilon|1,\frac{1}{2},\frac{1}{4},\cdots\}=2\epsilon\\
&\{0|\epsilon\}=\frac{\epsilon}{2}\\
&\{0,1,2,3,\cdots,\omega|\}=\omega+1\\
&\{0,1,2,3,\cdots|\omega\}=\omega-1\\
&\{\omega|\omega+1\}=\omega+\frac{1}{2}\\
\end{aligned}\\
$$



# Geometry

## 法向量极角序

如果将$\vec{AB}$的法向量放在单位圆上，当$\vec{v}$与该法向量重合时，$\vec{OA}.dot(\vec{v})=\vec{OB}.dot(\vec{v})$，而在法向量的一侧满足$\vec{OA}.dot(\vec{v})<\vec{OB}.dot(\vec{v})$，另一侧满足$\vec{OA}.dot(\vec{v})>\vec{OB}.dot(\vec{v})$。

## 球面几何

设球冠的高为 $h$ ，半径为 $R$ ，则表面积为 $2\pi Rh$ 。

球面三角形的面积为 $(A+B+C-\pi)R^{2}$ 。

球面正弦定理：$\frac{\sin A}{a} = \frac{\sin B}{b} = \frac{\sin C}{c}$

球面余弦定理：$\cos a=\cos b\cos c+\sin b\sin c\cos A$, $\cos A=-\cos B\cos C+\sin B\sin C\cos a$

## 其它

简单多边形中的抛物线长度可以用有向线段来计算。

极角排序后扫描线可以分成上下两个半平面后归并。

有理坐标正多边形只有正方形一种。




# Best Theorem
边编号，则有向图中本质不同的欧拉回路数量为：

$$
ec(G) = t_w(G) \prod_{v \in V}{(\deg(v) - 1)!}
$$

其中，$t_w(G)$ 表示以 $w$ 为根的树形图个数，deg 是入度，这里 $w$ 可以任选。通过 Matrix-Tree theorem 可知，有向图中以 $w$ 为根的树形图个数，等于该图对应的基尔霍夫矩阵对于 $w$ 所在行列的余子式。其中基尔霍夫矩阵等于入度矩阵减去反图的邻接矩阵。

# 2-Sat

判断变量 $x_i$ 是否可以取 $1$，如果 $x_i$ 和 $\lnot x_i$ 不在一个连通块，那么 $x_i$ 可以取任意值；否则在一个连通块，那么 $x_i$ 在 $\lnot x_i$ 拓扑序后面的时候可以取 $1$。模板中只需要判断 `bel[i] < bel[i + n]` 即可。

# Matrix Tree

无向图关联矩阵 $B$，行是点，列是边。若 $e_k=(v_i,v_j)$ 那么 $B_{ik},B_{jk}$ 中一个为 $1$ 一个为 $-1$。它的 Kirchhoff 矩阵为 $BB^T$，也即度数矩阵 $-$ 邻接矩阵。

性质：

1. 任意图 $G$ 的 Kirchhoff 矩阵 $C$ 的行列式为 $0$（行/列向量和为 $0$ 向量）

2. 不连通图 $G$ 的 Kirchhoff 矩阵 $C$ 的任一个 $n-1$ 阶主子式行列式为 $0$

3. 若 $G$ 是一棵树，任一个 $n-1$ 阶主子式行列式为 $1$

根据 Cauchy–Binet formula，把 $C_r=B_rB_r^T$ 展开，得到：

$$
\begin{aligned}
|C\_r|=|B\_rB\_r^T|&=\sum\_{S\subset \{1,2,\dots,m\},|S|=n-1}|(B\_r)\_S||(B\_r)\_S^T|\\\\
&=\sum\_{S\subset \{1,2,\dots,m\},|S|=n-1}|(B\_r)\_S|^2
\end{aligned}
$$

若 $S$ 中 $n-1$ 条边形成了树，那么贡献 $1$；否则贡献 $0$

推广：

1. 自环删掉，重边 $(i,j)$ 有 $m$ 条边，则 $C_{ij}=C_{ji}=-m$，度数同样要计算在内。

2. 有向图，入度矩阵 $-$ 邻接矩阵，行向量之和为 $0$ 向量。

3. 边带权，令 $C_{ij}=C_{ji}=-w_{ij},C_{ii}=-\sum_{i\neq j}C_{ij}$。则 $n-1$ 阶主子式的值为：

$$
\sum_{T\text{ form a tree }}\left(\prod_{e\in T}w_e\right)
$$

4. 求恰有 $k$ 条特殊边的生成树个数，把 $k$ 条边边权设为 $x$，那么 $n-1$ 阶主子式的值是一个多项式，对应阶的系数即为答案。可以用插值而不是多项式高消求解。

# 上下界网络流

## 1.无源无汇有容量下界网络的可行流
$step1.$ 建立附加源 $s$ 和汇 $t$。

$step2.$ 添加弧 $t\to s$ 并设容量为无穷大。

$step3.$ 将原图中上界为 $c$，下界为 $b$ 的弧 $u\to v$ 拆成三条弧：$s\to v$ 和 $u \to t$，容量都为 $b$，以及 $u\to v$，流量为 $c-b$。

$step4.$ 对附加弧进行合并：对于原图中每个点 $i$ 记录 $d[i]=\sum\limits_{e:s\to i} cap(e) - \sum\limits_{e:i\to t} cap(e)$。
如果 $d[i]>0$，则连一条容量为 $d[i]$ 的弧 $s\to i$；如果 $d[i]<0$，则连一条容量为 $-d[i]$ 的弧 $i\to t$。

$step5.$ 求改造后的网络的s-t最大流，当且仅当所有的附加弧满载时原网络有可行流。

## 2.有源汇有容量下界网络的s-t可行流

$step1.$ 建立超级源 $ss$ 和 $tt$。

$step2.$ 添加弧 $t\to s$ 并设容量为无穷大。

$step3.$ 将原图中上界为 $c$，下界为 $b$ 的弧 $u\to v$ 拆成三条弧：$ss\to v$ 和 $u \to tt$，容量都为 $b$，以及 $u\to v$，流量为 $c-b$。

$step4.$ 对附加弧进行合并：对于原图中每个点 $i$ 记录 $d[i]=\sum\limits_{e:ss\to i} cap(e) - \sum\limits_{e:i\to tt} cap(e)$。
如果 $d[i]>0$，则连一条容量为 $d[i]$ 的弧 $ss\to i$，如果 $d[i]<0$，则连一条容量为 $-d[i]$ 的弧 $i\to tt$。

$step5.$ 求改造后的网络的ss-tt最大流，当且仅当所有的附加弧满载时原网络有s-t可行流。

# 高合成数表

|      高合成数       | 约数个数 |
| :-----------------: | :------: |
|          1          |    1     |
|          2          |    2     |
|          4          |    3     |
|          6          |    4     |
|         12          |    6     |
|         24          |    8     |
|         36          |    9     |
|         48          |    10    |
|         60          |    12    |
|         120         |    16    |
|         180         |    18    |
|         240         |    20    |
|         360         |    24    |
|         720         |    30    |
|         840         |    32    |
|        1260         |    36    |
|        1680         |    40    |
|        2520         |    48    |
|        5040         |    60    |
|        7560         |    64    |
|        10080        |    72    |
|        15120        |    80    |
|        20160        |    84    |
|        25200        |    90    |
|        27720        |    96    |
|        45360        |   100    |
|        50400        |   108    |
|        55440        |   120    |
|        83160        |   128    |
|       110880        |   144    |
|       166320        |   160    |
|       221760        |   168    |
|       277200        |   180    |
|       332640        |   192    |
|       498960        |   200    |
|       554400        |   216    |
|       665280        |   224    |
|       720720        |   240    |
|       1081080       |   256    |
|       1441440       |   288    |
|       2162160       |   320    |
|       2882880       |   336    |
|       3603600       |   360    |
|       4324320       |   384    |
|       6486480       |   400    |
|       7207200       |   432    |
|       8648640       |   448    |
|      10810800       |   480    |
|      14414400       |   504    |
|      17297280       |   512    |
|      21621600       |   576    |
|      32432400       |   600    |
|      36756720       |   640    |
|      43243200       |   672    |
|      61261200       |   720    |
|      73513440       |   768    |
|      110270160      |   800    |
|      122522400      |   864    |
|      147026880      |   896    |
|      183783600      |   960    |
|      245044800      |   1008   |
|      294053760      |   1024   |
|      367567200      |   1152   |
|      551350800      |   1200   |
|      698377680      |   1280   |
|      735134400      |   1344   |
|     1102701600      |   1440   |
|     1396755360      |   1536   |
|     2095133040      |   1600   |
|     2205403200      |   1680   |
|     2327925600      |   1728   |
|     2793510720      |   1792   |
|     3491888400      |   1920   |
|     4655851200      |   2016   |
|     5587021440      |   2048   |
|     6983776800      |   2304   |
|     10475665200     |   2400   |
|     13967553600     |   2688   |
|     20951330400     |   2880   |
|     27935107200     |   3072   |
|     41902660800     |   3360   |
|     48886437600     |   3456   |
|     64250746560     |   3584   |
|     73329656400     |   3600   |
|     80313433200     |   3840   |
|     97772875200     |   4032   |
|    128501493120     |   4096   |
|    146659312800     |   4320   |
|    160626866400     |   4608   |
|    240940299600     |   4800   |
|    293318625600     |   5040   |
|    321253732800     |   5376   |
|    481880599200     |   5760   |
|    642507465600     |   6144   |
|    963761198400     |   6720   |
|    1124388064800    |   6912   |
|    1606268664000    |   7168   |
|    1686582097200    |   7200   |
|    1927522396800    |   7680   |
|    2248776129600    |   8064   |
|    3212537328000    |   8192   |
|    3373164194400    |   8640   |
|    4497552259200    |   9216   |
|    6746328388800    |  10080   |
|    8995104518400    |  10368   |
|    9316358251200    |  10752   |
|   13492656777600    |  11520   |
|   18632716502400    |  12288   |
|   26985313555200    |  12960   |
|   27949074753600    |  13440   |
|   32607253879200    |  13824   |
|   46581791256000    |  14336   |
|   48910880818800    |  14400   |
|   55898149507200    |  15360   |
|   65214507758400    |  16128   |
|   93163582512000    |  16384   |
|   97821761637600    |  17280   |
|   130429015516800   |  18432   |
|   195643523275200   |  20160   |
|   260858031033600   |  20736   |
|   288807105787200   |  21504   |
|   391287046550400   |  23040   |
|   577614211574400   |  24576   |
|   782574093100800   |  25920   |
|   866421317361600   |  26880   |
|  1010824870255200   |  27648   |
|  1444035528936000   |  28672   |
|  1516237305382800   |  28800   |
|  1732842634723200   |  30720   |
|  2021649740510400   |  32256   |
|  2888071057872000   |  32768   |
|  3032474610765600   |  34560   |
|  4043299481020800   |  36864   |
|  6064949221531200   |  40320   |
|  8086598962041600   |  41472   |
|  10108248702552000  |  43008   |
|  12129898443062400  |  46080   |
|  18194847664593600  |  48384   |
|  20216497405104000  |  49152   |
|  24259796886124800  |  51840   |
|  30324746107656000  |  53760   |
|  36389695329187200  |  55296   |
|  48519593772249600  |  57600   |
|  60649492215312000  |  61440   |
|  72779390658374400  |  62208   |
|  74801040398884800  |  64512   |
| 106858629141264000  |  65536   |
| 112201560598327200  |  69120   |
| 149602080797769600  |  73728   |
| 224403121196654400  |  80640   |
| 299204161595539200  |  82944   |
| 374005201994424000  |  86016   |
| 448806242393308800  |  92160   |
| 673209363589963200  |  96768   |
| 748010403988848000  |  98304   |
| 897612484786617600  |  103680  |
| 1122015605983272000 |  107520  |
| 1346418727179926400 |  110592  |
| 1795224969573235200 |  115200  |
| 2244031211966544000 |  122880  |
| 2692837454359852800 |  124416  |
| 3066842656354276800 |  129024  |
| 4381203794791824000 |  131072  |
| 4488062423933088000 |  138240  |
| 6133685312708553600 |  147456  |
| 8976124847866176000 |  153600  |
| 9200527969062830400 |  161280  |


# 其它

## 拉格朗日插值法

对某个多项式函数，已知有给定的 $k+1$ 个取值点： $(x_{0},y_{0}),\cdots,(x_{k},y_{k})$ ，则有 $L(x)=\sum\limits_{i=0}^{k}y_{i}l_{i}(x)$ ，其中每个 $l_{i}(x)$ 为拉格朗日基本多项式，其表达式为 $l_{i}(x)=\prod\limits_{j=0,j\neq i}^{k}\frac{x-x_{j}}{x_{i}-x_{j}}$

## 牛顿迭代法

$x_{n+1}=x_{n}-\frac{f(x_{n})}{f'(x_{n})}$

## Stern-Brocut tree

设有一棵无限的区间树，根结点所表示的区间为$[\frac{0}{1}, \frac{1}{0}]$ ，设父结点所表示的区间为 $[\frac{a}{b},\frac{c}{d}]$ ，则它的左右孩子分别表示 $[\frac{a}{b},\frac{a+c}{b+d}]$ 和 $[\frac{a+c}{b+d},\frac{c}{d}]$ ，这棵树不重不漏地表示了所有正的既约的有理数。

## Tree of primitive Pythagorean triples

设有一棵无限的满三叉树，根结点表示列向量 $(3,4,5)^{T}$ ，设有三个矩阵
$$
A=\begin{pmatrix}
1&-2&2\\
2&-1&2\\
2&-2&3\\
\end{pmatrix}
$$

$$
B=\begin{pmatrix}
1&2&2\\
2&1&2\\
2&2&3\\
\end{pmatrix}
$$

$$
C=\begin{pmatrix}
-1&2&2\\
-2&1&2\\
-2&2&3\\
\end{pmatrix}
$$

设父结点的向量为 $\alpha$ ，则它从左到右的三个孩子的向量分别为 $A\alpha, B\alpha, C\alpha$ ，这棵树不重不漏地枚举完了所有基本毕达哥拉斯三元组（$a^{2}+b^{2}=c^{2}$）。

## 最大反链

给定一个非负整数数列 $\{t_{i}\}$，那么偏序集 $\prod_{i=1}^{n}\{x|0\le x\le t_{i},x\in\mathbb{Z}\}$ 的最大反链的大小等于关于 $x_{i}$ 的不定方程 $\displaystyle{\sum_{i=1}^{n}x_{i}=\lfloor\frac{\sum_{i=1}^{n}t_{i}}{2}\rfloor}$ 的非负整数解的个数。

## 矩阵乘法

设 $\oplus,\otimes$ 为二元运算，且 $\oplus$ 满足交换律和结合律，$\otimes$ 满足结合律，$\otimes$ 对 $\oplus$ 满足分配律。定义新的矩阵乘法 $A_{n,m}\times B_{m,p}=C_{n,p}$，其中 $c_{i,j}=\bigoplus_{k=1}^{m}a_{i,k}\otimes b_{k,j}$，那么这种矩阵乘法满足结合律。除了通常的 $\oplus$ 代表加法和 $\otimes$ 代表乘法外，$\oplus$ 代表取最大/最小值，$\otimes$ 代表加法；在 $[0,+\infty)$ 上定义 $\oplus$ 代表取最大/最小值，$\otimes$ 代表乘法，都满足条件。其中后两者对一些求最优值的 `dp` 优化有一定的作用。[证明](matrix_multiplication)

## gcc内建二进制函数

- `__builtin_popcount(x)` 表示 $x$ 二进制中 $1$ 的个数。
- `__builtin_parity(x)` 表示 $x$ 二进制中 $1$ 的个数的奇偶性。
- `__builtin_clz(x)` 表示 $x$ 二进制中前导 $0$ 的个数。
- `__builtin_ctz(x)` 表示 $x$ 二进制中结尾 $0$ 的个数。
- `__builtin_ffs(x)` 表示 $x$ 二进制中右起第一个 $1$ 的位置。

以上函数传入的参数为 `unsigned int`，如需对 `unsigned long long` 使用，需要在函数名的最后加上 `ll`，如 `__builtin_popcountll`。`__builtin_clz(x)` 和 `__builtin_ctz(x)` 两者在 $x=0$ 时未定义

## 一类关于集合的计数问题

设有两个集合 $A,B\subset\mathbb{N}$，且 $0\in A,1\in B,|A|=n,|B|=m$。定义 $A+B=\{x+y|x\in A,y\in B\}$，若 $A+B=[1,nm]\cap\mathbb{N}^{+}$，则称 $(A,B)$ 是好的。问这样的集合对有多少个。

这一问题的答案为：

$$
\begin{cases}
&1&(n=1\lor m=1)\\
&f(n,m)+f(m,n)&(n>1\land m>1)
\end{cases}
$$

其中 $f(n,m)=\sum_{i=1}^{+\infty}g_{i}(n)(g_{i}(m)+g_{i+1}(m))$，$g_{i}(n)$ 表示将 $n$ 分解成 $i$ 个大于 $1$ 的数的乘积的方案数（有序）。[证明](set_counting)

## 加法链

对于一个正整数 $n$，它的一个加法链是一个序列 $v_{0},\cdots,v_{s}$，其中 $v_{0}=1,v_{s}=n$，对于所有的 $v_{1},\cdots,v_{s}$，它们都是前面某两个数的和。一种常见的较短的加法链即为快速幂对指数的拆分方法。设 $n$ 的二进制表示下 $1$ 的个数为 $v(n)$，那么使用快速幂的加法链的长度为 $\lfloor\log_{2}n\rfloor+v(n)-1$。另外，设 $n$ 最短的加法链长度为 $l(n)$，$Knuth$ 猜想 $l(n)\ge\lfloor\log_{2}n\rfloor+\lceil\log_{2}v(n)\rceil$，且这一猜想对 $v(n)\le8$ 已经得到证明。



# 数论

## 连分数与佩尔方程

记 $<x_{0},x_{1},x_{2},x_{3},\cdots> = x_{0}+\frac{1}{x_{1}+\frac{1}{x_{2}+\frac{1}{x_{3}+\cdots}}}$ ，其中 $x_{i}>0(i\ge1)$ 。称 $\frac{p_{n}}{q_n}=<x_{0},x_{1},\cdots,x_{n}>$ 为它的第 $n$ 个渐近分数。补充定义 $p_{-1}=1,q_{-1}=0$ ，则有递推式 $p_{n}=x_{n}p_{n-1}+p_{n-2},q_{n}=x_{n}q_{n-1}+q_{n-2}(n\ge1)$ 。对无限简单连分数，我们称 $\xi_{n}=<x_{n},x_{n+1},\cdots>$ 为它的第 $n$ 个完全商，满足 $\xi_{0}=\frac{p_{n}\xi_{n+1}+p_{n-1}}{q_{n}\xi_{n+1}+q_{n-1}}$。一个实数是二次根式当且仅当它是循环简单连分数，我们用 $<x_{0},\cdots,x_{m_{0}-1},<\overline{x_{m_{0}},\cdots,x_{m_{0}+l-1}}>>$ ，其中 $l$ 是 $\xi_{0}$ 的周期。设 $\xi_{0}=\frac{\sqrt{d}+c_{0}}{r_{0}},q_{0}|d-c^{2}_{0}$ ，我们有 $\xi_{n}=\frac{\sqrt{d}+c_{n}}{r_{n}}$ ，其中 $r_{n+1}=r_{n-1}+\frac{c_{n}^{2}-c_{n+1}^{2}}{r_{n}}=r_{n-1}+(c_{n}-c_{n+1})x_{n}$,$c_{n+1}=x_{n}r_{n}-c_{n}$,$a_{n}=\lfloor\xi_{n}\rfloor(n\ge1)$ 。

我们给出两个不定方程： $x-dy^{2}=1$ 和 $x-dy^{2}=-1$ ，若 $d$ 为完全平方数，则第一个方程只有解 $(\pm1,0)$ ，第二个方程无解。若 $d$ 不为完全平方数，设 $\xi_{0}=\sqrt{d}$ ，设它的循环连分数周期为 $l$ ，渐近分数为 $\frac{p_{n}}{q_{n}}$ ，则：

- 当 $l$ 为偶数时，第一个方程的全体正解为 $x=p_{jl-1},y=q_{jl-1},j=1,2,3,\cdots$ ，第二个方程无解
- 当 $l$ 为奇数时，第一个方程的全体正解为 $x=p_{jl-1},y=q_{jl-1},j=2,4,6,\cdots$ ，第二个方程的全体正解为 $x=p_{jl-1},y=q_{jl-1},j=1,3,5,\cdots$

还有另一种更加简单的表示方法：

- 当 $l$ 为偶数时，第一个方程的全体解为 $x+y\sqrt{d}=\pm(p_{l-1}\pm q_{l-1}\sqrt{d})^{j},j=0,1,2,\cdots$ ，第二个方程无解
- 当 $l$ 为奇数时，第一个方程的全体正解为 $x+y\sqrt{d}=\pm(p_{l-1}\pm q_{l-1}\sqrt{d})^{j},j=0,2,4,\cdots$ ，第二个方程的全体正解为 $x+y\sqrt{d}=\pm(p_{l-1}\pm q_{l-1}\sqrt{d})^{j},j=1,3,5,\cdots$

## 指数循环节

对 $\forall a, b, n \in N^{+}, b \ge \phi(n)$ ，有 $a ^ {b} \equiv a ^ {b \% \phi(n) + \phi(n)}\pmod{n}$ ，注意 $b \ge \phi(n)$ 是必要条件，以及式子中取模后指数必须加上 $\phi(n)$ ，否则结果可能会出错。

## 威尔逊定理

$$
\prod_{i=1,\text{gcd}(i,m)=1}^{m}i\equiv\begin{cases}
&-1&(m=1,2,4,p^{l},2p^{l},\text{ p is odd prime})\\
&1&(\text{otherwise})
\end{cases}\pmod{m}
$$

## 类欧几里得算法

设 $f(a,b,c,n,t_{1},t_{2})=\sum_{i=0}^{n}i^{t_{1}}\lfloor\frac{ai+b}{c}\rfloor^{t_{2}}$，求解这一函数值的算法称为类欧几里得算法。这里仅讨论 $6$ 个参数均为非负整数的情况，且定义 $0^{0}=1$：

定义 $m=\lfloor\frac{an+b}{c}\rfloor$，$g_{t}(x)=(x+1)^{t}-x^{t}=\sum_{i=0}^{t-1}g_{ti}x^{i}$，$h_{t}(x)=\sum_{i=1}^{x}i^{t}=\sum_{i=0}^{t+1}h_{ti}x_{i}$。

- 若 $t_{2}=0$，有：

$$
原式=h_{t_{1}}(n)+[t_{1}=0]
$$

- 若 $m=0$，有：

$$
原式=0
$$

- 若 $a=0$，有：

$$
原式=\lfloor\frac{b}{c}\rfloor^{t_{2}}(h_{t_{1}}(n)+[t_{1}=0])
$$

- 若 $a\ge c$ 或 $b\ge c$，有：

$$
原式=\sum_{u_{1}+u_{2}+u_{3}=t_{2}}{t_{2}\choose u_{1},u_{2},u_{3}}(\lfloor\frac{a}{c}\rfloor)^{u_{2}}(\lfloor\frac{b}{c}\rfloor)^{u_{3}}f(a\%c,b\%c,c,n,t_{1}+u_{2},u_{1})
$$

- 若 $0\le a,b<c$，有：

$$
原式=m^{t_{2}}h_{t_{1}}(n)-\sum_{u=0}^{t_{2}-1}\sum_{v=0}^{t_{1}+1}g_{t_{2}u}h_{t_{1}v}f(c,c-b-1,a,m-1,u,v)
$$

特别地，若 $t_{1}=0,t_{2}=1$，则有：

- 若 $m=0$，有：

$$
原式=0
$$

- 若 $a=0$，有：

$$
原式=\lfloor\frac{b}{c}\rfloor(n+1)
$$

- 若 $a\ge c$ 或 $b\ge c$，有：

$$
原式=\frac{n(n+1)}{2}\lfloor\frac{a}{c}\rfloor+(n+1)\lfloor\frac{b}{c}\rfloor+f(a\%c,b\%c,c,n,t_{1},t_{2})
$$

- 若 $0\le a,b<c$，有：

$$
原式=nm-f(c,c-b-1,a,m-1,t_{1},t_{2})
$$

[证明](similar_euclid)

## 其他

$x^{2}+y^{2}=t$ 的整数解的个数为 $4(\sigma_{1}(t)-\sigma_{3}(t))$，其中 $\sigma_{1}(t)$ 表示 $t$ 的约数中模 $4$ 余 $1$ 的个数，$\sigma_{3}(t)$ 表示 $t$ 的约数中模 $4$ 余 $3$ 的个数。



