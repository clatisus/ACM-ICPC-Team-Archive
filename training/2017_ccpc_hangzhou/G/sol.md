## G Marriage

**题目大意**：有 $n$ 个家族，每个家族有 $a_{i}$ 个男子和 $b_{i}$ 个女子，$\sum_{i=1}^{n}a_{i}=\sum_{i=1}^{n}b_{i}$，求他们结婚的方案数，要求同一个家族的人不能结婚。

**题解**：容斥。设 $f(i)$ 表示选取 $i$ 对同家族结婚的方案数，那么显然答案为 $\sum_{i=0}^{sum}(-1)^{i}f(i)(sum-i)!$。

下面考虑如何求 $f(i)$。显然不同家族之间互不影响，那么有 $f(i)=\sum_{\sum_{j=1}^{n}t_{j}=i}\prod_{j=1}^{n}g(t_{j})$，其中 $g(t_{j})={a_{j}\choose t_{j}}{b_{j}\choose t_{j}}t_{j}!$。容易发现 $f$ 是一个卷积形式，可以用 $NTT$ 加速。做多项式乘法的时候，我们可以采用哈夫曼的思想，每次将次数最小的两个多项式合并，容易证明这样的复杂度为 $\mathcal{O}(n\log^{2}n)$。