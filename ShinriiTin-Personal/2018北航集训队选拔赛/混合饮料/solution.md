## Mixed Drinks

**题目大意：**

给出三个$1$到$n$的排列$a,b,c$.

令$T=\{(x,y,z)|S\subseteq[n]\land S\not=\emptyset,x=\max\limits_{i\in S} a_i,y=\max\limits_{i\in S} b_i,z=\max\limits_{i\in S} c_i\}$，求$|T|$.

$1\le n \le10^5$.

**题解：**

定义最简下标集合$S$为当其中任意一个元素删去后都会改变$(x,y,z)$的下标集合。

显然$1\le|S|\le3$.

- $|S|=1$，任意大小为$1$的集合都是合法的，对答案贡献$n$.

- $|S|=2$，不合法当前仅当其中一个点被另一个点支配，可以用分治的方法求得。

- $|S|=3$，比较复杂，考虑不合法的情况：

  > 其中一个点可以支配其它两个点，可以用分治的方法$O(n\log^2{n})$求得，记这样的集合数量为$A$.

  > 其中一个点在某两维最大，另一个点在剩下的一维最大，记这样的集合数量为$B$，那么枚举某两维，一样用分治的方法$O(n\log^2{n})$统计满足某一个点能在这两维上支配另外两个点的集合数量，分别记为$u$,$v$,$w$，则有$3A+B=u+v+w$，就可以解出$B$.

总的时间复杂度$O(n\log^2{n})$.
