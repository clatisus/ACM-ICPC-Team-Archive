## [F - Wide Swap](https://agc001.contest.atcoder.jp/tasks/agc001_f)

**题目大意：**

给出一个$1,\cdots,n$的排列$P$和常数$K$，$1\le K<n\le5\times10^5$。

如果$P$中存在两个位置$1\le i<j\le n$，且$j-i\ge K$，$|P_i-P_j|=1$，那么可以选择交换$P_i$和$P_j$。

可以经过任意次上述操作，求最终排列中字典序最小的。

**题解：**

首先证明，若$|i-j|<K$且$P_i<P_j$，在最终排列$P^{'}$中，一定有$P^{'}_i<P^{'}_j$。

令$Q$为$P$的逆运算，即$Q_{P_i}=i$，则对$P$的操作等价于对$Q$的操作：若$Q$中相邻的两个位置$|Q_i-Q_j|\ge K$，则可以交换$Q_i,Q_j$。

因此如果$|i-j|<K$且$P_i<P_j$，则在$Q$中有$i<j$，$|Q_i-Q_j|<K$，而要改变相对位置，必须发生一次它们在相邻位置的交换，而这是不可能的。

有了上述性质，原问题就转化为了，一个$n$个点的有向图，若$|i-j|<K$且$P_i<P_j$，则图中存在一条从$i$到$j$的出边，求该有向图的字典序最小拓扑序。

这个问题的做法很简单，每次贪心的找到编号最大的出度为$0$的点，将它添加到逆拓扑序的下一位，然后删掉该点和它所有的入边，不断重复直到所有点都被加入逆拓扑序。

因为边数很多，达到了$O(n^2)$级别，我们不可能真的去建出图来，但是根据本题的性质可以得到，$i$没有出度，当且仅当区间$[i-K+1,i+K-1]$的最大值等于$P_i$。

因此可以用线段树维护单点修改和区间查询最值，来$O(\log{n})$删除一个点，以及check一个点是否没有出度。

然后将原序列按大小$K$分块，每一块中没有出度的点只可能是块内$P$最大的点，而删去一个点只会影响最多$3$块的情况。

再顺便用`priority_queue`维护一下没有出度的点的编号大小即可。

时间复杂度$O(n\log{n})$.