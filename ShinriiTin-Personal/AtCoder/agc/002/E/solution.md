## [E - Candy Piles](https://agc002.contest.atcoder.jp/tasks/agc002_e)

**题目大意：**

有$n\le10^5$堆糖果，第$i$堆糖果的数量为$1\le a_i\le10^9$，两个小朋友玩游戏，轮流操作，每次操作必须选择以下两种操作之一：

- 吃掉当前最多的那堆糖果

- 从当前剩下的每堆糖果中吃掉一个

吃掉最后一个糖果的人输。如果都采取最优策略，问先手胜还是后手胜。

**题解：**

将$a$从大到小排序，然后按$a_1,\cdots,a_n$像统计的柱形图一样画出方格图，则问题转化为从$(0,0)$出发轮流向上或向右走一步，走到轮廓边界的人输。

可以将轮廓上的点看做必胜态，则可以证明，不在轮廓上的点，同一对角线上的点的状态是相同的，证明如下。

若$(x,y),(x+1,y+1),(x+2,x+2)$都存在，$(x+2,y+2)$可能在轮廓上，则$(x,y)$和$(x+1,y+1)$一定相同。

用反证法分两种情况讨论：

- 如果$(x,y)$为必胜态，$(x+1,y+1)$为必败态，因为$(x,y)$为必胜态，因此$(x+1,y)$和$(x,y+1)$至少有一个为必败态，而必败态不能到达任何一个必败态，与$(x+1,y+1)$为必败态矛盾；

- 如果$(x,y)$为必败态，$(x+1,y+1)$为必胜态，因为$(x,y)$为必败态，则$(x+1,y)$和$(x,y+1)$都是必胜态，而必胜态至少要能到达一个必败态，因此$(x+2,y)$和$(x,y+2)$都是必败态，又因此$(x+2,y+1)$和$(x+1,y+2)$都是必胜态，与$(x+1,y+1)$为必胜态矛盾；

因此不在轮廓上的点，同一对角线上的点的状态是相同的。

因此问题转化为求同一对角线上最接近轮廓线的点的状态，这个状态和它向上和向右两个方向到轮廓线的距离的奇偶性有关。

如果两个距离都为偶数，则为必败态，否则为必胜态，证明如下。

其中一个距离为零，这种情况，同一行或者同一列的状态是交替分布的，满足条件。

两个距离都不为零，这种情况，考虑向右一个位置和向上一个位置的两个位置，当且仅当它们都是必胜态的时候，当前位置为必败。

而这两个位置的状态和上一条证明的规律相符，因此该规律对当前情况也成立。

因此整个算法的时间复杂度为排序所需的复杂度$O(n\log{n})$。